Nada Al-Mutairi
nada_almutairi
In voice

Sondos Alrubaish ‚Äî 5:24 AM
from flask import Flask
from flask_restx import Api
from flask_cors import CORS

from app.extensions import db, bcrypt, jwt

def create_app(config_class):
    app = Flask(name)
    app.config.from_object(config_class)

    CORS(app, 
         resources={r"/api/": {"origins": ""}},
         supports_credentials=True,
         allow_headers=["Content-Type", "Authorization"],
         methods=["GET", "POST", "PUT", "DELETE", "OPTIONS"])

    db.init_app(app)
    bcrypt.init_app(app)
    jwt.init_app(app)

    api = Api(
        app,
        version="1.0",
        title="HBnB API",
        description="HBnB Application API",
        doc="/api/v1/"
    )

    from app.api.v1.users import api as users_ns
    from app.api.v1.auth import api as auth_ns
    from app.api.v1.amenities import api as amenities_ns
    from app.api.v1.places import api as places_ns
    from app.api.v1.reviews import api as reviews_ns

    api.add_namespace(users_ns, path="/api/v1/users")
    api.add_namespace(auth_ns, path="/api/v1/auth")
    api.add_namespace(amenities_ns, path="/api/v1/amenities")
    api.add_namespace(places_ns, path="/api/v1/places")
    api.add_namespace(reviews_ns, path="/api/v1/reviews")

    return app
Shaden ‚Äî 9:42 PM
Science in Financial Economics
investment
Financial Analysis

FinTech
Sondos Alrubaish ‚Äî 10:12 PM
from app.extensions import db

class SQLAlchemyRepository:
    def init(self, model):
        self.model = model

    def add(self, obj):
        db.session.add(obj)
        db.session.commit()
        return obj

    def get_by_id(self, obj_id):

        return db.session.get(self.model, obj_id)

    def get_all(self):
        return self.model.query.all()

    def update(self):
        db.session.commit()

    def delete(self, obj):
        db.session.delete(obj)
        db.session.commit()
----
from app.extensions import db
from app.repositories.sqlalchemy_repository import SQLAlchemyRepository
from app.models.review import Review


class ReviewRepository(SQLAlchemyRepository):
    def init(self):
        super().init(Review)

    def get_by_user_and_place(self, user_id, place_id):
        return (
            self.model.query
            .filter_by(user_id=user_id, place_id=place_id)
            .first()
        )
    def get_by_place_id(self, place_id):
        return Review.query.filter_by(place_id=place_id).order_by(Review.created_at.desc()).all()
---
from app.extensions import db
from app.repositories.sqlalchemy_repository import SQLAlchemyRepository
from app.models.place import Place


class PlaceRepository(SQLAlchemyRepository):
    def init(self):
        super().init(Place)

    def get_by_owner(self, user_id):
        return self.model.query.filter_by(owner_id=user_id).all()
----
from app.extensions import db
from app.repositories.sqlalchemy_repository import SQLAlchemyRepository
from app.models.amenity import Amenity


class AmenityRepository(SQLAlchemyRepository):
    def init(self):
        super().init(Amenity)

    def get_by_name(self, name):
        return self.model.query.filter_by(name=name).first()
---
from app.extensions import db, bcrypt
from app.models.base_model import BaseModel


class User(BaseModel):
    tablename = "users"

    email = db.Column(db.String(128), nullable=False, unique=True)
    password = db.Column(db.String(128), nullable=False)
    first_name = db.Column(db.String(128), nullable=True)
    last_name = db.Column(db.String(128), nullable=True)
    is_admin = db.Column(db.Boolean, default=False)

    places = db.relationship("Place", back_populates="owner", cascade="all, delete-orphan")
    reviews = db.relationship("Review", back_populates="user", cascade="all, delete-orphan")

    def set_password(self, password: str):
        self.password = bcrypt.generate_password_hash(password).decode("utf-8")

    def check_password(self, password: str) -> bool:
        return bcrypt.check_password_hash(self.password, password)

    def to_dict(self):
        return {
            "id": self.id,
            "email": self.email,
            "first_name": self.first_name,
            "last_name": self.last_name,
            "is_admin": self.is_admin,
            "created_at": self.created_at.isoformat() if self.created_at else None,
            "updated_at": self.updated_at.isoformat() if self.updated_at else None,
        }
----
from app.extensions import db
from app.models.base_model import BaseModel


class Review(BaseModel):
    tablename = "reviews"

    text = db.Column(db.String(1000), nullable=False)
    rating = db.Column(db.Integer, nullable=False)

    user_id = db.Column(db.String(36), db.ForeignKey("users.id"), nullable=False)
    place_id = db.Column(db.String(36), db.ForeignKey("places.id"), nullable=False)

    table_args = (
        db.UniqueConstraint("user_id", "place_id", name="uq_review_user_place"),
        db.CheckConstraint("rating >= 1 AND rating <= 5", name="ck_review_rating_1_5"),
    )

    user = db.relationship("User", back_populates="reviews")
    place = db.relationship("Place", back_populates="reviews")

    def to_dict(self):
        return {
            "id": str(self.id),
            "text": self.text,
            "rating": self.rating,
            "user_id": str(self.user_id),
            "place_id": str(self.place_id),
            "created_at": self.created_at.isoformat() if self.created_at else None,
            "updated_at": self.updated_at.isoformat() if self.updated_at else None,
            "user": {
                "id": str(self.user.id),
                "first_name": self.user.first_name,
                "last_name": self.user.last_name,
                "email": self.user.email
            }
    }
----
from app.extensions import db
from app.models.base_model import BaseModel


class Amenity(BaseModel):
    tablename = "amenities"

    name = db.Column(db.String(50), nullable=False, unique=True)

    places = db.relationship(
        "Place",
        secondary="place_amenity",
        back_populates="amenities"
    )

    def to_dict(self):
        return {
            "id": self.id,
            "name": self.name,
            "created_at": self.created_at.isoformat() if self.created_at else None,
            "updated_at": self.updated_at.isoformat() if self.updated_at else None,
        }
Sondos Alrubaish ‚Äî 10:20 PM
----
from sqlalchemy import create_engine
from config import config


def get_engine(env="development"):
    return create_engine(
        config[env].SQLALCHEMY_DATABASE_URI,
        echo=False,
        future=True
    )
----
from sqlalchemy.orm import sessionmaker
from app.db.database import get_engine

SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=get_engine()
)
Nada Al-Mutairi ‚Äî 10:23 PM
>
Sondos Alrubaish ‚Äî 10:23 PM
=========
# app/api/v1/users.py

from flask_restx import Resource, Namespace, fields
from flask_jwt_extended import jwt_required, get_jwt_identity, get_jwt
from app.services.facade import facade
from app.extensions import db

message.txt
5 KB
Nada Al-Mutairi ‚Äî 10:25 PM
>
Sondos Alrubaish ‚Äî 10:25 PM
======
from flask import request
from flask_restx import Namespace, Resource, fields
from flask_jwt_extended import jwt_required, get_jwt_identity

from app.services.facade import facade

api = Namespace('reviews', description='Review operations')

review_model = api.model('Review', {
    'text': fields.String(required=True, description='Review text'),
    'rating': fields.Integer(required=True, description='Rating (1-5)'),
    'place_id': fields.String(required=True, description='Place ID')
})

@api.route('/')
class ReviewList(Resource):
    def get(self):
        try:
            place_id = request.args.get('place_id')

            if place_id:
                reviews = facade.get_reviews_by_place(place_id)
            else:
                reviews = facade.get_all_reviews()

            return [r.to_dict() for r in reviews], 200

        except ValueError as e:
            api.abort(400, str(e))
        except Exception as e:
            api.abort(500, f"Error: {str(e)}")

    @api.expect(review_model)
    @jwt_required()
    def post(self):
        try:
            current_user_id = get_jwt_identity()
            review_data = api.payload or {}

            rating = review_data.get('rating')
            try:
                rating_int = int(rating)
            except (TypeError, ValueError):
                api.abort(400, 'Rating must be between 1 and 5')

            if rating_int < 1 or rating_int > 5:
                api.abort(400, 'Rating must be between 1 and 5')

            review_data["user_id"] = current_user_id

            new_review = facade.create_review(review_data)
            return new_review.to_dict(), 201

        except ValueError as e:
            api.abort(400, str(e))
        except Exception as e:
            api.abort(500, f"Error: {str(e)}")
Nada Al-Mutairi ‚Äî 10:25 PM
>
Sondos Alrubaish ‚Äî 10:27 PM
from flask_restx import Resource, Namespace, fields
from flask_jwt_extended import create_access_token
from app.services.facade import facade

api = Namespace("auth", description="Authentication operations")

login_model = api.model("Login", {
    "email": fields.String(required=True, description="User email"),
    "password": fields.String(required=True, description="User password"),
})

token_model = api.model("Token", {
    "access_token": fields.String,
})


@api.route("/login")
class Login(Resource):

    @api.expect(login_model, validate=True)
    @api.marshal_with(token_model)
    def post(self):
        data = api.payload or {}

        email = (data.get("email") or "").strip()
        password = data.get("password")

        if not email or not password:
            api.abort(400, "Missing email or password")

        user = facade.user_repo.get_by_email(email)
        if not user or not user.check_password(password):
            api.abort(401, "Invalid email or password")

        access_token = create_access_token(
            identity=str(user.id),
            additional_claims={"is_admin": user.is_admin}
        )

        return {"access_token": access_token}, 200
Nada Al-Mutairi ‚Äî 10:27 PM
>
Sondos Alrubaish ‚Äî 10:30 PM
scripts.js
Nada Al-Mutairi ‚Äî 10:31 PM
>
Sondos Alrubaish ‚Äî 10:31 PM
// ============================================
// HBnB - Final Clean JavaScript
// ============================================

const API_URL = 'http://127.0.0.1:5000/api/v1';

// ========== Cookie Helpers ==========
function getCookie(name) {
    const value = ; ${document.cookie};
    const parts = value.split(; ${name}=);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
}

function setCookie(name, value, days = 7) {
    const d = new Date();
    d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
    document.cookie = ${name}=${value}; path=/; expires=${d.toUTCString()};
}

function deleteCookie(name) {
    document.cookie = ${name}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;
}

// ========== Auth Functions ==========
function isAuthenticated() {
    return getCookie('token') !== null;
}

function updateAuthUI() {
    const loginBtn = document.getElementById('login-btn');
    const userMenu = document.getElementById('user-menu');
    const userInitial = document.getElementById('user-initial');
    const email = localStorage.getItem('userEmail');

    if (isAuthenticated() && email) {
        if (loginBtn) loginBtn.style.display = 'none';
        if (userMenu) {
            userMenu.classList.remove('hidden');
            userMenu.classList.add('flex');
        }
        if (userInitial) {
            userInitial.textContent = email.charAt(0).toUpperCase();
        }
    } else {
        if (loginBtn) loginBtn.style.display = 'inline-block';
        if (userMenu) {
            userMenu.classList.add('hidden');
            userMenu.classList.remove('flex');
        }
    }
}

function setupLogout() {
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            deleteCookie('token');

message.txt
5 KB
Nada Al-Mutairi ‚Äî 10:33 PM
>
Sondos Alrubaish ‚Äî 10:35 PM
async function displayPlaces() {
    const container = document.getElementById('places-list');
    if (!container) return;
    await displayPlacesInContainer(container, 'price-filter');
}

async function displayPlacesInContainer(container, filterElementId) {
    if (!container) return;

    try {
        const places = await fetchPlaces();

        if (!places || places.length === 0) {
            container.innerHTML = '<div class="col-span-full text-center py-12 text-gray-600">No places available</div>';
            return;
        }

        function renderPlaces(list) {
            container.innerHTML = list.map(p => createPlaceCard(p)).join('');
            setupFavorites();
        }

        renderPlaces(places);

        const filter = document.getElementById(filterElementId);
        if (filter) {
            filter.addEventListener('change', (e) => {
                const val = e.target.value;
                if (val === 'all') {
                    renderPlaces(places);
                } else {
                    const filtered = places.filter(p => p.price_per_night <= Number(val));
                    renderPlaces(filtered);
                }
            });
        }
    } catch (error) {
        container.innerHTML = '<div class="col-span-full text-center py-12 text-red-600">Error loading places</div>';
    }
}
Nada Al-Mutairi ‚Äî 10:36 PM
>
Sondos Alrubaish ‚Äî 10:36 PM
function setupFavorites() {
    document.querySelectorAll('.favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();

            const id = btn.dataset.id;
            const icon = btn.querySelector('i');
            const isFav = localStorage.getItem(fav_${id}) === 'true';

            if (isFav) {
                localStorage.removeItem(fav_${id});
                icon.classList.remove('fas');
                icon.classList.add('far');
            } else {
                localStorage.setItem(fav_${id}, 'true');
                icon.classList.remove('far');
                icon.classList.add('fas');
            }
        });
    });
}

// ========== Place Details ==========
async function fetchPlaceDetails(id) {
    try {
        const response = await fetch(${API_URL}/places/${id});
        if (!response.ok) throw new Error('Failed');
        return await response.json();
    } catch (error) {
        return null;
    }
}
Nada Al-Mutairi ‚Äî 10:37 PM
>
Sondos Alrubaish ‚Äî 10:37 PM

async function fetchReviews(placeId) {
    console.log('üîç Fetching reviews for place:', placeId);
    try {
        const url = `${API_URL}/reviews/?place_id=${placeId}`;
        console.log('üì° Full URL:', url);

message.txt
8 KB
===

// ========== Star Rating ==========
let currentRating = 0;

function setupStarRating() {
    console.log('‚≠ê Setting up star rating...');

message.txt
5 KB
====
place.html
Sondos Alrubaish ‚Äî 10:45 PM
====
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBnB - Places</title>

message.txt
7 KB
====
login.html
====
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HBnB - Login to book luxury stays">

message.txt
9 KB
====
/* ============================================
   HBnB - Lavender Unified Design System
   ============================================ */

:root {
    --lavender: #9B7BB8;        /* Primary */

styles.css
9 KB
===
index.html
====
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HBnB - Discover luxury stays in Riyadh. Premium accommodations with exceptional service.">

message.txt
18 KB
Sondos Alrubaish ‚Äî 10:52 PM
====
add_review.html
ŸÜÿØŸâ
Nada Al-Mutairi ‚Äî 10:53 PM
>
Sondos Alrubaish ‚Äî 10:54 PM
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HBnB - Add Review</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Header -->
  <header>
    <img src="images/logo.png" alt="HBnB Logo" class="logo">
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="login.html" id="login-link">Login</a>
      <span id="user-email" class="user-greeting"></span>
      <button id="logout-btn" class="logout-btn" style="display: none;">Logout</button>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    <!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ©: ÿπÿ±ÿ∂ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ -->
    <section style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px; border-left: 4px solid #7A5A9A;">
      <h2 style="margin: 0; color: #333;">Add Review for: <span id="place-name" style="color: #7A5A9A;">Loading...</span></h2>
    </section>

    <!-- ‚úÖ ÿ™ÿµÿ≠Ÿäÿ≠: class name ŸÖŸÜ login-form ÿ•ŸÑŸâ review-form -->
    <form id="standalone-review-form" class="review-form">
      <h2>Add a Review</h2>

      <!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ©: hidden input ŸÑŸÑŸÄ place ID -->
      <input type="hidden" id="place-id" value="">

      <label for="rating-select">Rating:</label>
      <select id="rating-select" name="rating" required>
        <option value="" disabled selected>Select rating</option>
        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 stars)</option>
        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4 stars)</option>
        <option value="3">‚≠ê‚≠ê‚≠ê (3 stars)</option>
        <option value="2">‚≠ê‚≠ê (2 stars)</option>
        <option value="1">‚≠ê (1 star)</option>
      </select>

      <label for="review-text">Review Text:</label>
      <textarea id="review-text" name="review" rows="6" placeholder="Write your review here..." required></textarea>

      <button type="submit">Submit Review</button>
      <p id="review-message" class="message"></p>
    </form>
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 HBnB ‚Äî All rights reserved</p>
  </footer>

  <script src="scripts.js"></script>
  <!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ©: JavaScript ÿ®ÿ≥Ÿäÿ∑ Ÿàÿ¢ŸÖŸÜ ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const placeId = urlParams.get('id') || urlParams.get('place');
      
      if (placeId) {
        document.getElementById('place-id').value = placeId;
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ ŸÖŸÜ ÿßŸÑŸÄ API
        fetch(`${API_URL}/places/${placeId}`)
          .then(response => {
            if (response.ok) {
              return response.json();
            }
            return null;
          })
          .then(place => {
            if (place) {
              document.getElementById('place-name').textContent = place.title || 'Place';
            } else {
              document.getElementById('place-name').textContent = 'Unknown Place';
            }
          })
          .catch(error => {
            console.error('Error loading place:', error);
            document.getElementById('place-name').textContent = 'Place';
          });
      }
    });
  </script>
</body>
</html>

!DOCTYPE html.txt
4 KB
Ôªø
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HBnB - Add Review</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Header -->
  <header>
    <img src="images/logo.png" alt="HBnB Logo" class="logo">
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="login.html" id="login-link">Login</a>
      <span id="user-email" class="user-greeting"></span>
      <button id="logout-btn" class="logout-btn" style="display: none;">Logout</button>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    <!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ©: ÿπÿ±ÿ∂ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ -->
    <section style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px; border-left: 4px solid #7A5A9A;">
      <h2 style="margin: 0; color: #333;">Add Review for: <span id="place-name" style="color: #7A5A9A;">Loading...</span></h2>
    </section>

    <!-- ‚úÖ ÿ™ÿµÿ≠Ÿäÿ≠: class name ŸÖŸÜ login-form ÿ•ŸÑŸâ review-form -->
    <form id="standalone-review-form" class="review-form">
      <h2>Add a Review</h2>

      <!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ©: hidden input ŸÑŸÑŸÄ place ID -->
      <input type="hidden" id="place-id" value="">

      <label for="rating-select">Rating:</label>
      <select id="rating-select" name="rating" required>
        <option value="" disabled selected>Select rating</option>
        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 stars)</option>
        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4 stars)</option>
        <option value="3">‚≠ê‚≠ê‚≠ê (3 stars)</option>
        <option value="2">‚≠ê‚≠ê (2 stars)</option>
        <option value="1">‚≠ê (1 star)</option>
      </select>

      <label for="review-text">Review Text:</label>
      <textarea id="review-text" name="review" rows="6" placeholder="Write your review here..." required></textarea>

      <button type="submit">Submit Review</button>
      <p id="review-message" class="message"></p>
    </form>
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 HBnB ‚Äî All rights reserved</p>
  </footer>

  <script src="scripts.js"></script>
  <!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ©: JavaScript ÿ®ÿ≥Ÿäÿ∑ Ÿàÿ¢ŸÖŸÜ ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const placeId = urlParams.get('id') || urlParams.get('place');
      
      if (placeId) {
        document.getElementById('place-id').value = placeId;
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ ŸÖŸÜ ÿßŸÑŸÄ API
        fetch(`${API_URL}/places/${placeId}`)
          .then(response => {
            if (response.ok) {
              return response.json();
            }
            return null;
          })
          .then(place => {
            if (place) {
              document.getElementById('place-name').textContent = place.title || 'Place';
            } else {
              document.getElementById('place-name').textContent = 'Unknown Place';
            }
          })
          .catch(error => {
            console.error('Error loading place:', error);
            document.getElementById('place-name').textContent = 'Place';
          });
      }
    });
  </script>
</body>
</html>
